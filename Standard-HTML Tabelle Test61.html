<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Full cost transparency</title>
  <style>
    :root{
      --border:#d0d7de; --bg-parent:#f6f8fa; --text:#24292f;
      --pink:#ffc0cb; --blue:#8ec5ff; --lblue:#d6ebff; --green:#bff5c8; --green2:#a8e9b3;
      --ease-soft:cubic-bezier(.22,.61,.36,1);
      --ease-verysoft:cubic-bezier(.2,.8,.2,1);
      --ease-spring:cubic-bezier(.16,1,.3,1);
      --t-opacity:900ms; --t-geom:1800ms; --t-border:1200ms;
      --stagger-step:120ms;
      --card-open:680ms cubic-bezier(.16,1,.3,1);
      --card-close:560ms cubic-bezier(.2,.8,.2,1);
      --container-max:1200px; --page-pad:clamp(16px,3vw,28px);
    }

    html{
      min-height:100%;
      background-image:
        linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,.06) 40%, rgba(255,255,255,.12) 100%),
        url("banner%20sin%20nada%20png.png");
      background-position:center, center; background-size:cover, cover;
      background-repeat:no-repeat, no-repeat; background-attachment:fixed, fixed;
    }
    body{ font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; color:var(--text); margin:0; background:transparent; }
    .container{ max-width:var(--container-max); margin:0 auto; padding:var(--page-pad); }

    /* Top Bar */
    .top-bar{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:10px; }
    h1#main-title{ font-size:clamp(1.25rem,2.1vw,1.6rem); margin:0; line-height:1.25; }
    .brand-right{ display:flex; align-items:flex-start; gap:12px; padding-right:clamp(8px,1.6vw,18px); }
    .crest{ width:clamp(110px,12vw,160px); height:auto; filter:drop-shadow(0 4px 14px rgba(0,0,0,.12)); transform:translateZ(0); }

    .sub{ font-size:.95rem; color:#374151; margin:6px 0 10px; }
    .hint{ font-size:.9rem; color:#57606a; margin:0 0 16px; }
    .is-hidden{ display:none; }

    /* Layout */
    .page-grid{ display:grid; grid-template-columns:1fr; gap:16px; align-items:start; }
    .header-area{ display:grid; grid-template-columns:1fr; gap:14px; }
    @media (min-width:960px){ .header-area{ grid-template-columns:1.1fr .9fr; } }

    .header-card{
      position:relative; border:1px solid var(--border); border-radius:14px; background:rgba(255,255,255,.94);
      box-shadow:0 6px 24px rgba(0,0,0,.06); backdrop-filter:saturate(120%) blur(3px);
      padding:14px 16px; overflow:visible;
      transition: box-shadow .5s var(--ease-soft), transform .5s var(--ease-spring), filter .5s var(--ease-soft);
    }
    .header-card:hover{ box-shadow:0 10px 28px rgba(0,0,0,.08); }
    .card-head{ display:flex; align-items:center; justify-content:space-between; margin:-6px 0 10px; }
    .card-title{ margin:0; font-size:.95rem; font-weight:700; color:#1f2937; }

    /* Toolbar – positions swapped as requested: language LEFT (order:1), button RIGHT (order:3) */
    .toolbar{ display:flex; gap:.6rem; align-items:center; flex-wrap:wrap; }
    .controls{ order:1; display:flex; gap:.5rem; align-items:center; }
    .toolbar .cta-text{ order:2; font-size:.92rem; color:#334155; max-width:520px; }
    #toggle-columns-btn{ order:3; }
    .toolbar button{
      padding:10px 14px; border:1px solid #c5d1e3; background:#e8f0f9; border-radius:10px; cursor:pointer;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
      transition: background .25s var(--ease-soft), transform .18s var(--ease-soft), box-shadow .25s var(--ease-soft);
    }
    .toolbar button:hover{ background:#dbe8f7; box-shadow:0 2px 6px rgba(0,0,0,.08); }
    .toolbar button:active{ transform:translateY(1px); }
    .controls label{ font-size:.9rem; color:#334155; }
    .controls select{ padding:8px 10px; border:1px solid var(--border); border-radius:8px; background:#fff; }

    /* Chips / Key Facts */
    .key-facts{ display:flex; flex-wrap:wrap; gap:8px 10px; margin:2px 0 2px; }
    .chip{
      position:relative; display:inline-flex; align-items:center; gap:8px;
      background:#fff; color:#111827; border:1px solid var(--border); border-radius:999px;
      padding:6px 10px; font-size:.9rem; line-height:1.2; box-shadow:0 2px 6px rgba(0,0,0,.04);
    }
    .chip .label{ font-weight:600; } .chip .value{ opacity:.9; }
    .dot{ width:8px; height:8px; border-radius:999px; display:inline-block; }
    .dot-lblue{ background:var(--lblue); } .dot-gray{ background:#bbb; }

    .chip-accent{ background:#fff7cc; border-color:#f0c420; box-shadow:0 4px 14px rgba(240,196,32,.25); font-size:1rem; padding:8px 12px; font-weight:700; animation:pulse 2.4s ease-in-out infinite; }
    .chip-accent .value{ opacity:1; }
    .dot-warn{ background:#f0c420; }
    @keyframes pulse{ 0%,100%{ box-shadow:0 4px 14px rgba(240,196,32,.25);} 50%{ box-shadow:0 6px 22px rgba(240,196,32,.38);} }

    .chip-tip{
      position:absolute; left:50%; transform:translateX(-50%); bottom:100%; margin-bottom:8px;
      background:#111827; color:#fff; padding:8px 10px; border-radius:8px; white-space:nowrap;
      font-size:.85rem; opacity:0; pointer-events:none; transition:opacity .18s ease;
      box-shadow:0 8px 22px rgba(0,0,0,.18); z-index:5;
    }
    .chip:hover .chip-tip, .chip:focus-within .chip-tip{ opacity:1; }

    @media (max-width:720px){ .chip{ font-size:.85rem; padding:5px 9px; } .chip-accent{ font-size:.95rem; } }

    /* Table Card */
    .table-card{
      border:1px solid var(--border); border-radius:14px; background:#fff; box-shadow:0 10px 30px rgba(0,0,0,.06);
      overflow:visible; transition: box-shadow .6s var(--ease-soft), transform .6s var(--ease-spring), filter .6s var(--ease-soft);
      position:relative; z-index:1;
    }
    .table-card.opening{ animation:cardOpen var(--card-open); }
    .table-card.closing{ animation:cardClose var(--card-close); }
    @keyframes cardOpen{ 0%{ opacity:.94; transform:translateY(-4px) scale(.997); filter:saturate(.94) blur(.35px);} 60%{ opacity:1; transform:translateY(0) scale(1.001);} 100%{ opacity:1; transform:none;} }
    @keyframes cardClose{ 0%{ opacity:1; transform:none;} 100%{ opacity:.985; transform:translateY(-2px) scale(.999);} }

    .table-wrap{ position:relative; overflow:visible; }
    table{ width:100%; border-collapse:collapse; table-layout:fixed; background:#fff; border-radius:14px; }
    thead th{ text-align:center; background:var(--bg-parent); border:1px solid var(--border); padding:10px; position:relative; }
    tbody td, tbody th{ border:1px solid var(--border); padding:10px; vertical-align:middle; text-align:center; }

    thead th, tbody td{
      transition:
        opacity var(--t-opacity) var(--ease-verysoft),
        width   var(--t-geom)   var(--ease-spring),
        padding-left  var(--t-geom) var(--ease-spring),
        padding-right var(--t-geom) var(--ease-spring),
        border-width  var(--t-border) var(--ease-soft),
        border-color  var(--t-border) var(--ease-soft),
        background-color .62s var(--ease-soft);
      transition-delay: var(--stagger,0ms);
    }

    /* Collapsed behaviour (colors unchanged) */
    #cost-table.collapsed .col-1,
    #cost-table.collapsed .col-2,
    #cost-table.collapsed .col-3,
    #cost-table.collapsed .col-4,
    #cost-table.collapsed .col-5{
      opacity:0; width:0 !important; padding-left:0 !important; padding-right:0 !important; border-width:0 !important; border-color:transparent !important; overflow:hidden;
    }
    #cost-table.collapsed .col-6{ background:var(--green) !important; border:2px solid #000 !important; }
    #cost-table.collapsed .col-7{ background:var(--green2) !important; border:2px solid #000 !important; }

    /* Colors expanded (unchanged) */
    #cost-table:not(.collapsed) .col-2{ background:var(--pink) !important; }
    #cost-table:not(.collapsed) .col-3{ background:var(--lblue) !important; }
    #cost-table:not(.collapsed) .col-4{ background:var(--lblue) !important; }
    #cost-table:not(.collapsed) .col-5{ background:var(--blue) !important; }
    #cost-table:not(.collapsed) .col-6{ background:var(--green) !important; border:2px solid #000 !important; }
    #cost-table:not(.collapsed) .col-7{ background:var(--green2) !important; }

    /* Row hover */
    #cost-table:not(.collapsed) tbody tr > th,
    #cost-table:not(.collapsed) tbody tr > td{ transition:box-shadow 360ms var(--ease-verysoft), font-weight 240ms var(--ease-verysoft); }
    #cost-table:not(.collapsed) tbody tr:hover > th,
    #cost-table:not(.collapsed) tbody tr:hover > td{ box-shadow:inset 0 0 0 100vmax rgba(255,235,150,.16); }
    #cost-table:not(.collapsed) tbody tr:hover > .col-6,
    #cost-table:not(.collapsed) tbody tr:focus-within > .col-6{ font-weight:700; }

    /* Tip bubbles */
    table, thead, tr, th{ overflow:visible; }
    .tip-bubble{
      position:absolute; left:50%; transform:translateX(-50%); bottom:100%; margin-bottom:8px;
      background:#111827; color:#fff; padding:8px 10px; border-radius:8px; white-space:nowrap;
      font-size:.9rem; opacity:0; pointer-events:none; transition:opacity .18s ease; z-index:5;
      box-shadow:0 8px 22px rgba(0,0,0,.18);
    }
    th:hover .tip-bubble, th:focus-within .tip-bubble{ opacity:1; }
    .dot-tip{ display:inline-block; width:8px; height:8px; border-radius:999px; margin-right:6px; vertical-align:middle; }
    .pink{ background:var(--pink); } .blue{ background:var(--blue); } .lblue{ background:var(--lblue); } .green{ background:var(--green); }

    td.invert-cell{ background:#000; color:#fff; }
    .italic{ font-style:italic; }

    @media (prefers-reduced-motion:reduce){
      .table-card{ animation:none !important; }
      thead th, tbody td{ transition:none !important; }
    }

    /* Popup */
    .popup{
      position:fixed; inset:auto 12px 12px 12px; z-index:50;
      display:none; align-items:flex-start; gap:10px;
      background:#fffef6; border:1px solid #f0c420; border-radius:12px;
      box-shadow:0 12px 28px rgba(0,0,0,.15);
      padding:12px 14px;
    }
    .popup.show{ display:flex; }
    .popup .icon{ width:24px; height:24px; flex:0 0 24px; }
    .popup .msg{ font-weight:600; line-height:1.3; }
    .popup .close{ margin-left:auto; border:none; background:transparent; font-size:18px; cursor:pointer; line-height:1; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Top-Bar -->
    <div class="top-bar">
      <h1 id="main-title">Llistat de preus English Montessori 2.0 (Vista resuminda)</h1>
      <div class="brand-right" aria-label="Schullogo">
        <img class="crest" src="ESCUDO%202%20BLANCO.png" alt="Schul-Wappen" />
      </div>
    </div>

    <p class="sub is-hidden" id="sub-title">aixi veus on van els teus diners al detall</p>
    <p class="hint" id="hint">
      Im eingeklappten Zustand bleiben nur die Spalten <strong>Alumnes</strong>,
      <strong>Preu/Classe per alumnes</strong> und <strong>Al mes – 4x setmanas</strong> sichtbar.
    </p>

    <div class="page-grid">
      <div class="header-area">
        <!-- Card 1: Sprache & Einstellungen -->
        <section class="header-card" aria-label="Sprache & Einstellungen">
          <div class="card-head">
            <h2 class="card-title" id="card1-title">Sprache &amp; Einstellungen</h2>
          </div>
          <div class="toolbar" role="region" aria-label="Werkzeuge">
            <!-- Language left -->
            <div class="controls">
              <label for="lang-select" id="lang-label">Sprache:</label>
              <select id="lang-select" aria-label="Language selector">
                <option value="ca">Català</option>
                <option value="es">Castellano</option>
                <option value="en">English</option>
              </select>
            </div>
            <span class="cta-text" id="cta-line">
              Vols entendre com fixem els preus? → Clica aquí i comprova la nostra transparència i sinceritat en tots els costos.
            </span>
            <!-- Button right -->
            <button type="button" id="toggle-columns-btn" aria-live="polite">Mostrar totes les columnes</button>
          </div>
        </section>

        <!-- Card 2: Key Facts (Lloguer-CHIP ENTFERNT) -->
        <section class="header-card" aria-label="Key Facts">
          <div class="card-head">
            <h2 class="card-title" id="card2-title">Key Facts</h2>
          </div>

          <div class="key-facts" id="facts">
            <span class="chip chip-accent" role="note" aria-live="polite">
              <span class="dot dot-warn" aria-hidden="true"></span>
              <span class="value" id="chip-payonly" data-i18n="chip_payonly">Es paga només per les classes a les quals s’assisteix</span>
              <span class="chip-tip" id="chip-payonly-tip">Pagament just: sense assistència, sense cost.</span>
            </span>

            <span class="chip">
              <span class="dot dot-gray" aria-hidden="true"></span>
              <span class="label" data-i18n="chip_alumnes_label">Alumnes:</span>
              <span class="value" id="chip-alumnes-val">1–8</span>
              <span class="chip-tip" id="tip-chip-alumnes">Entre 1 i 8 alumnes per classe</span>
            </span>
            <span class="chip">
              <span class="dot dot-lblue" aria-hidden="true"></span>
              <span class="label" data-i18n="chip_class_label">Temps classe:</span>
              <span class="value" id="chip-class-val">90&nbsp;min</span>
              <span class="chip-tip" id="tip-chip-class">Duració típica d’una sessió</span>
            </span>
            <!-- (kein Lloguer-Chip mehr hier) -->
            <span class="chip">
              <span class="dot dot-gray" aria-hidden="true"></span>
              <span class="label" data-i18n="chip_time_label">Horari:</span>
              <span class="value" id="chip-time-val">~16:45–18:15</span>
              <span class="chip-tip" id="tip-chip-time">Horari habitual de les classes</span>
            </span>
          </div>
        </section>
      </div>

      <!-- Tabelle -->
      <section class="table-card" id="table-card">
        <div class="table-wrap">
          <table id="cost-table" class="collapsed" aria-live="polite">
            <thead>
              <tr>
                <th tabindex="0" class="col-0" id="th-alumnes">
                  Alumnes
                  <span class="tip-bubble"><span class="dot-tip" style="background:#999"></span><span data-i18n="tip_alumnes">Mida del grup: entre 1 i 8 alumnes com a màxim</span></span>
                </th>
                <th tabindex="0" class="col-1" id="th-preu-base">
                  <span class="col-label" data-i18n="th_base">Preu base/classe per alumne</span>
                  <span class="tip-bubble"><span class="dot-tip" style="background:#000"></span><span data-i18n="tip_base">Preu base orientat a classe particular «Only for you»</span></span>
                </th>
                <th tabindex="0" class="col-2" id="th-material">
                  <span data-i18n="th_material">Cost de material</span>
                  <span class="tip-bubble"><span class="dot-tip pink"></span><span data-i18n="tip_material">Per alumne i sessió: 2,50 € en material/manteniment</span></span>
                </th>
                <th tabindex="0" class="col-3" id="th-mes">
                  <span data-i18n="th_mes">Temps preparació classe/mes (hores)</span>
                  <span class="tip-bubble"><span class="dot-tip lblue"></span><span data-i18n="tip_mes">1 h de prep. al mes pel primer alumne, +30 min per cadascun extra</span></span>
                </th>
                <th tabindex="0" class="col-4" id="th-prep-min">
                  <span data-i18n="th_prepmin">Temps de preparació de classe/dia (min.)</span>
                  <span class="tip-bubble"><span class="dot-tip lblue"></span><span data-i18n="tip_prepmin">Com més gran el grup, més temps de preparació</span></span>
                </th>
                <th tabindex="0" class="col-5" id="th-prep-dia">
                  <span data-i18n="th_prepdia">Preu de preparació de classe/dia</span>
                  <span class="tip-bubble"><span class="dot-tip blue"></span><span data-i18n="tip_prepdia">Tarifa de preparació: 10 €/h</span></span>
                </th>
                <th tabindex="0" class="col-6" id="th-preu-classe">
                  <span data-i18n="th_preuclasse">Preu/Classe per alumnes</span>
                  <span class="tip-bubble"><span class="dot-tip green"></span><span data-i18n="tip_preuclasse">Preu per alumne i classe</span></span>
                </th>
                <th tabindex="0" class="col-7" id="th-mes4">
                  <span data-i18n="th_mes4">Al mes - 4x setmanes</span>
                  <span class="tip-bubble"><span class="dot-tip" style="background:#bbb"></span><span data-i18n="tip_mes4">Preu mensual (4 setmanes)</span></span>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td><td class="invert-cell">20.00 €</td><td>2.50 €</td><td>1 h</td><td>00:15:00</td><td>2.50 €</td><td>25.00 €</td><td>100.00 €</td>
              </tr>
              <tr><td>2</td><td>19.00 €</td><td>5.00 €</td><td>1.5 h</td><td>00:22:30</td><td>3.75 €</td><td>23.38 €</td><td>93.50 €</td></tr>
              <tr><td>3</td><td>18.00 €</td><td>7.50 €</td><td>2 h</td><td>00:30:00</td><td>5.00 €</td><td>22.17 €</td><td>88.67 €</td></tr>
              <tr><td>4</td><td>17.00 €</td><td>10.00 €</td><td>2.5 h</td><td>00:37:30</td><td>6.25 €</td><td>21.06 €</td><td>84.25 €</td></tr>
              <tr><td>5</td><td>16.00 €</td><td>12.50 €</td><td>3 h</td><td>00:45:00</td><td>7.50 €</td><td>20.00 €</td><td>80.00 €</td></tr>
              <tr><td>6</td><td>15.00 €</td><td>15.00 €</td><td>3.5 h</td><td>00:52:30</td><td>8.75 €</td><td>18.96 €</td><td>75.83 €</td></tr>
              <tr><td>7</td><td class="italic">13.00 €</td><td>17.50 €</td><td>4 h</td><td>01:00:00</td><td>10.00 €</td><td>16.93 €</td><td>67.71 €</td></tr>
              <tr><td>8</td><td class="italic">12.00 €</td><td>20.00 €</td><td>4.5 h</td><td>01:07:30</td><td>11.25 €</td><td>15.91 €</td><td>63.63 €</td></tr>
            </tbody>
          </table>

          <!-- Separate Gruppe unter der Tabelle: IRPF 15% & Lloguer 50€ -->
          <section class="header-card" aria-label="IRPF & Lloguer" style="margin-top:12px;">
            <div class="card-head">
              <h2 class="card-title" id="below-title">IRPF &amp; Lloguer</h2>
            </div>
            <div class="key-facts" id="facts-below">
              <span class="chip">
                <span class="dot dot-gray" aria-hidden="true"></span>
                <span class="label" id="chip-irpf-label">IRPF:</span>
                <span class="value" id="chip-irpf-val">15%</span>
                <span class="chip-tip" id="chip-irpf-tip">Retenció fiscal segons normativa vigent</span>
              </span>
              <span class="chip">
                <span class="dot dot-gray" aria-hidden="true"></span>
                <span class="label" id="chip-lloguer-label">Lloguer:</span>
                <span class="value" id="chip-lloguer-val">50,00 €</span>
                <span class="chip-tip" id="chip-lloguer-tip">Cost de l’espai per franja horària</span>
              </span>
            </div>
          </section>
        </div>
      </section>
    </div>
  </div>

  <!-- Popups -->
  <div class="popup" id="popup-rotate">
    <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M7 4h10a2 2 0 0 1 2 2v8m-4 6H7a2 2 0 0 1-2-2V8" stroke="#1f2937" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M16 18a5 5 0 0 0 5-5" stroke="#1f2937" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M21 13v-3m0 0h-3" stroke="#1f2937" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    <div class="msg" id="popup-rotate-text">Gira el mòbil per veure millor la taula de detalls.</div>
    <button class="close" aria-label="Cerrar" data-close="popup-rotate">✕</button>
  </div>

  <div class="popup" id="popup-portrait">
    <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <rect x="7" y="3" width="10" height="18" rx="2" stroke="#1f2937" stroke-width="1.5"/>
      <path d="M12 19v2M12 3V1" stroke="#1f2937" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    <div class="msg" id="popup-portrait-text">Torna el mòbil a la posició vertical per a la vista resumida.</div>
    <button class="close" aria-label="Cerrar" data-close="popup-portrait">✕</button>
  </div>

  <script>
    (function(){
      const table     = document.getElementById('cost-table');
      const tableCard = document.getElementById('table-card');
      const btn       = document.getElementById('toggle-columns-btn');
      const h1        = document.getElementById('main-title');
      const sub       = document.getElementById('sub-title');
      const hint      = document.getElementById('hint');
      const card1Title= document.getElementById('card1-title');
      const card2Title= document.getElementById('card2-title');

      const langSel   = document.getElementById('lang-select');
      const langLabel = document.getElementById('lang-label');
      const ctaLine   = document.getElementById('cta-line');

      const popupRotate   = document.getElementById('popup-rotate');
      const popupPortrait = document.getElementById('popup-portrait');
      const popupRotateText   = document.getElementById('popup-rotate-text');
      const popupPortraitText = document.getElementById('popup-portrait-text');

      /* i18n */
      const i18n = {
        ca:{
          title_short:'Llistat de preus English Montessori 2.0 (Vista resuminda)',
          title_full:'Transparència total de costos',
          doc_title:'Transparència total de costos',
          hint:'En estat plegat només es veuen les columnes <strong>Alumnes</strong>, <strong>Preu/Classe per alumnes</strong> i <strong>Al mes – 4x setmanes</strong>.',
          btn_expand:'Mostrar totes les columnes',
          btn_collapse:'Tornar a la vista resumida',
          lang_label:'Llengua:',
          card1:'Llengua i configuració',
          card2:'Dades clau',
          keyfacts:'Dades clau',
          cta:'Vols entendre com fixem els preus? → Clica aquí i comprova la nostra transparència i sinceritat en tots els costos.',
          rotate_expand:'Gira el mòbil per veure millor la taula de detalls.',
          rotate_collapse:'Torna el mòbil a la posició vertical per a la vista resumida.',
          ths:['Alumnes','Preu base/classe per alumne','Cost de material','Temps prep. al mes (hores)','Temps de preparació al dia (min.)','Preu de preparació al dia','Preu/Classe per alumnes','Al mes - 4x setmanes'],
          tips:{
            alumnes:'Mida del grup: entre 1 i 8 alumnes com a màxim',
            base:'Preu base orientat a classe particular «Only for you»',
            material:'Per alumne i sessió: 2,50 € en material/manteniment',
            mes:'1 h de prep. al mes pel primer alumne, +30 min per cadascun extra',
            prepmin:'Com més gran el grup, més temps de preparació',
            prepdia:'Tarifa de preparació: 10 €/h',
            preuclasse:'Preu per alumne i classe',
            mes4:'Preu mensual (4 setmanes)'
          },
          chips:{ alumnes:'Alumnes:', classe:'Durada classe:', rent:'Lloguer:', time:'Horari:' },
          chipvals:{ classe:'90 min', rent:'50,00 €', time:'~16:45–18:15' },
          payonly:'Es paga només per les classes a les quals s’assisteix',
          payonly_tip:'Pagament just: sense assistència, sense cost.',
          below_title:'IRPF i Lloguer',
          below_labels:{ irpf:'IRPF:', lloguer:'Lloguer:' },
          below_values:{ irpf:'15%', lloguer:'50,00 €' },
          chip_tips:{
            alumnes:'Entre 1 i 8 alumnes per classe',
            classe:'Duració típica d’una sessió',
            rent:'Lloguer per franja horària',
            time:'Horari habitual de les classes',
            irpf:'Retenció fiscal (15%) segons normativa vigent',
            lloguer:'Cost de l’espai per franja horària'
          }
        },
        es:{
          title_short:'Listado de precios English Montessori 2.0 (Vista resuminda)',
          title_full:'Transparencia total de costos',
          doc_title:'Transparencia total de costos',
          hint:'En estado contraído solo se ven las columnas <strong>Alumnos</strong>, <strong>Precio/Clase por alumno</strong> y <strong>Al mes – 4x semanas</strong>.',
          btn_expand:'Mostrar todas las columnas',
          btn_collapse:'Volver a la vista resumida',
          lang_label:'Idioma:',
          card1:'Idioma y configuración',
          card2:'Datos clave',
          keyfacts:'Datos clave',
          cta:'¿Quieres entender cómo fijamos los precios? → Haz clic y comprueba nuestra transparencia y sinceridad en todos los costos.',
          rotate_expand:'Gira el móvil para ver mejor la tabla de detalles.',
          rotate_collapse:'Vuelve el móvil a la posición vertical para la vista resumida.',
          ths:['Alumnos','Precio base/clase por alumno','Costo de material','Tiempo prep. al mes (h)','Tiempo de preparación al día (min.)','Precio de preparación al día','Precio/Clase por alumno','Al mes - 4x semanas'],
          tips:{
            alumnes:'Tamaño del grupo: entre 1 y 8 como máximo',
            base:'Precio base orientado a clase particular «Only for you»',
            material:'Por alumno y sesión: 2,50 € de material/mantenimiento',
            mes:'1 h/mes para el primer alumno, +30 min por cada extra',
            prepmin:'Cuanto mayor el grupo, mayor preparación',
            prepdia:'Tarifa de preparación: 10 €/h',
            preuclasse:'Precio por alumno y clase',
            mes4:'Precio mensual (4 semanas)'
          },
          chips:{ alumnes:'Alumnos:', classe:'Duración clase:', rent:'Alquiler:', time:'Horario:' },
          chipvals:{ classe:'90 min', rent:'50,00 €', time:'~16:45–18:15' },
          payonly:'Solo pagas por las clases a las que asistes',
          payonly_tip:'Pago justo: si no asistes, no pagas.',
          below_title:'IRPF y Alquiler',
          below_labels:{ irpf:'IRPF:', lloguer:'Alquiler:' },
          below_values:{ irpf:'15%', lloguer:'50,00 €' },
          chip_tips:{
            alumnes:'Entre 1 y 8 alumnos por clase',
            classe:'Duración típica de una sesión',
            rent:'Alquiler por franja horaria',
            time:'Horario habitual de las clases',
            irpf:'Retención fiscal (15 %) según normativa',
            lloguer:'Coste del espacio por franja horaria'
          }
        },
        en:{
          title_short:'English Montessori 2.0 price list (Compact view)',
          title_full:'Full cost transparency',
          doc_title:'Full cost transparency',
          hint:'When collapsed, only <strong>Students</strong>, <strong>Price/Class per student</strong> and <strong>Per month – 4x weeks</strong> stay visible.',
          btn_expand:'Show all columns',
          btn_collapse:'Back to compact view',
          lang_label:'Language:',
          card1:'Language & settings',
          card2:'Key facts',
          keyfacts:'Key facts',
          cta:'Want to see how we set prices? → Click to check our transparency and honesty in all costs.',
          rotate_expand:'Rotate your phone to better view the details table.',
          rotate_collapse:'Return your phone to portrait for the compact view.',
          ths:['Students','Base price/class per student','Material cost','Prep time per month (h)','Prep time per day (min.)','Preparation price per day','Price/Class per student','Per month - 4x weeks'],
          tips:{
            alumnes:'Class size: between 1 and 8 students',
            base:'Base price references 1:1 lessons “Only for you”',
            material:'Per student & class: €2.50 for material/maintenance',
            mes:'1h/month for first student, +30m for each additional',
            prepmin:'Larger groups need more preparation time',
            prepdia:'Preparation rate: €10/hour',
            preuclasse:'Price per student per class',
            mes4:'Monthly price (4 weeks)'
          },
          chips:{ alumnes:'Students:', classe:'Class length:', rent:'Rent:', time:'Schedule:' },
          chipvals:{ classe:'90 min', rent:'€50.00', time:'~16:45–18:15' },
          payonly:'You only pay for the classes you attend',
          payonly_tip:'Fair billing: no attendance, no charge.',
          below_title:'Withholding & Rent',
          below_labels:{ irpf:'Withholding (IRPF):', lloguer:'Rent:' },
          below_values:{ irpf:'15%', lloguer:'€50.00' },
          chip_tips:{
            alumnes:'Between 1 and 8 students per class',
            classe:'Typical session length',
            rent:'Room rent per time slot',
            time:'Regular class times',
            irpf:'Tax withholding (15%) under local rules',
            lloguer:'Space cost per time slot'
          }
        }
      };

      /* Helpers */
      function tagColumns(){
        const headerRow = table.tHead.rows[0];
        for(let i=0;i<headerRow.children.length;i++){ headerRow.children[i].classList.add('col-'+i); }
        table.querySelectorAll('tbody tr').forEach(tr=>{
          for(let i=0;i<tr.children.length;i++){ tr.children[i].classList.add('col-'+i); }
        });
      }

      const HIDE_COLS = [1,2,3,4,5];
      function setStaggerDelays(expanding){
        const headerRow = table.tHead.rows[0];
        const rows = Array.from(table.tBodies[0].rows);
        HIDE_COLS.forEach((colIndex, idx) => {
          const order = expanding ? (HIDE_COLS.length - 1 - idx) : idx;
          const delay = `calc(${order} * var(--stagger-step))`;
          headerRow.children[colIndex].style.setProperty('--stagger', delay);
          rows.forEach(tr => tr.children[colIndex].style.setProperty('--stagger', delay));
        });
        [0,6,7].forEach(i=>{
          headerRow.children[i].style.removeProperty('--stagger');
          rows.forEach(tr => tr.children[i].style.removeProperty('--stagger'));
        });
      }

      function showPopup(el){
        el.classList.add('show');
        clearTimeout(el._t);
        el._t = setTimeout(()=>el.classList.remove('show'), 6000);
      }
      function hidePopup(el){ el.classList.remove('show'); if(el._t) clearTimeout(el._t); }
      document.querySelectorAll('.popup .close').forEach(b=>{
        b.addEventListener('click', (e)=>{
          const id = e.currentTarget.getAttribute('data-close');
          const p = document.getElementById(id);
          if(p) hidePopup(p);
        });
      });

      function setColumnsVisibility(expanded){
        setStaggerDelays(expanded);
        tableCard.classList.remove('opening','closing');

        if(expanded){
          tableCard.classList.add('opening');
          table.classList.remove('collapsed');
          h1.textContent = i18n[langSel.value].title_full;
          sub.classList.remove('is-hidden');
          btn.textContent = i18n[langSel.value].btn_collapse;
          popupRotateText.textContent = i18n[langSel.value].rotate_expand;
          showPopup(popupRotate);
          hidePopup(popupPortrait);
        } else {
          tableCard.classList.add('closing');
          table.classList.add('collapsed');
          h1.textContent = i18n[langSel.value].title_short;
          sub.classList.add('is-hidden');
          btn.textContent = i18n[langSel.value].btn_expand;
          popupPortraitText.textContent = i18n[langSel.value].rotate_collapse;
          showPopup(popupPortrait);
          hidePopup(popupRotate);
        }
        setTimeout(()=>tableCard.classList.remove('opening','closing'), 820);
      }

      function applyLanguage(lang){
        const expanded = !table.classList.contains('collapsed');

        h1.textContent = expanded ? i18n[lang].title_full : i18n[lang].title_short;
        hint.innerHTML = i18n[lang].hint;
        ctaLine.textContent = i18n[lang].cta;
        langLabel.textContent = i18n[lang].lang_label;
        document.title = i18n[lang].doc_title;
        btn.textContent = expanded ? i18n[lang].btn_collapse : i18n[lang].btn_expand;

        // Karten-Titel
        card1Title.textContent = i18n[lang].card1;
        card2Title.textContent = i18n[lang].keyfacts;
        document.getElementById('below-title').textContent = i18n[lang].below_title;

        // Header-Labels
        const thIds = ['th-alumnes','th-preu-base','th-material','th-mes','th-prep-min','th-prep-dia','th-preu-classe','th-mes4'];
        thIds.forEach((id, idx)=>{
          const th = document.getElementById(id);
          if(!th) return;
          const labelSpan = th.querySelector(':scope > span[data-i18n], :scope > span:not(.tip-bubble)');
          if(labelSpan) labelSpan.textContent = i18n[lang].ths[idx];
        });

        // Header-Tipps
        const tipMap = {
          'tip_alumnes':'alumnes',
          'tip_base':'base',
          'tip_material':'material',
          'tip_mes':'mes',
          'tip_prepmin':'prepmin',
          'tip_prepdia':'prepdia',
          'tip_preuclasse':'preuclasse',
          'tip_mes4':'mes4'
        };
        Object.entries(tipMap).forEach(([dataKey, k])=>{
          const el = document.querySelector(`[data-i18n="${dataKey}"]`);
          if(el) el.textContent = i18n[lang].tips[k];
        });

        // Chips & Werte (rent-Chip existiert nicht mehr → guard)
        const chipLabelMap = {
          'chip_alumnes_label':'alumnes',
          'chip_class_label':'classe',
          'chip_rent_label':'rent',   // bleibt für Untergruppe, oben aber kein Element
          'chip_time_label':'time'
        };
        Object.entries(chipLabelMap).forEach(([dataKey, k])=>{
          const el = document.querySelector(`[data-i18n="${dataKey}"]`);
          if(el) el.textContent = i18n[lang].chips[k];
        });

        const classVal = document.getElementById('chip-class-val');
        const rentVal  = document.getElementById('chip-rent-val');   // evtl. null (Chip entfernt)
        const timeVal  = document.getElementById('chip-time-val');
        if(classVal) classVal.innerHTML = i18n[lang].chipvals.classe;
        if(rentVal)  rentVal.innerHTML  = i18n[lang].chipvals.rent;
        if(timeVal)  timeVal.innerHTML  = i18n[lang].chipvals.time;

        // Pay-only Hinweis
        const payOnly = document.getElementById('chip-payonly');
        const payOnlyTip = document.getElementById('chip-payonly-tip');
        if(payOnly)    payOnly.textContent    = i18n[lang].payonly;
        if(payOnlyTip) payOnlyTip.textContent = i18n[lang].payonly_tip;

        // Key-Facts Chip-Tipps
        const tipAl = document.getElementById('tip-chip-alumnes');
        const tipCl = document.getElementById('tip-chip-class');
        const tipRt = document.getElementById('tip-chip-rent');  // evtl. null
        const tipTm = document.getElementById('tip-chip-time');
        if(tipAl) tipAl.textContent = i18n[lang].chip_tips.alumnes;
        if(tipCl) tipCl.textContent = i18n[lang].chip_tips.classe;
        if(tipRt) tipRt.textContent = i18n[lang].chip_tips.rent;
        if(tipTm) tipTm.textContent = i18n[lang].chip_tips.time;

        // Untere Facts (IRPF / Lloguer)
        document.getElementById('chip-irpf-label').textContent   = i18n[lang].below_labels.irpf;
        document.getElementById('chip-lloguer-label').textContent= i18n[lang].below_labels.lloguer;
        document.getElementById('chip-irpf-val').textContent     = i18n[lang].below_values.irpf;
        document.getElementById('chip-lloguer-val').textContent  = i18n[lang].below_values.lloguer;
        document.getElementById('chip-irpf-tip').textContent     = i18n[lang].chip_tips.irpf;
        document.getElementById('chip-lloguer-tip').textContent  = i18n[lang].chip_tips.lloguer;
      }

      /* Init */
      function initialMotion(){
        tableCard.classList.add('opening');
        setTimeout(()=>tableCard.classList.remove('opening'), 820);
      }

      function setStaggerDelays(expanding){
        const headerRow = table.tHead.rows[0];
        const rows = Array.from(table.tBodies[0].rows);
        const HIDE_COLS = [1,2,3,4,5];
        HIDE_COLS.forEach((colIndex, idx) => {
          const order = expanding ? (HIDE_COLS.length - 1 - idx) : idx;
          const delay = `calc(${order} * var(--stagger-step))`;
          headerRow.children[colIndex].style.setProperty('--stagger', delay);
          rows.forEach(tr => tr.children[colIndex].style.setProperty('--stagger', delay));
        });
        [0,6,7].forEach(i=>{
          headerRow.children[i].style.removeProperty('--stagger');
          rows.forEach(tr => tr.children[i].style.removeProperty('--stagger'));
        });
      }

      function setColumnsVisibility(expanded){
        setStaggerDelays(expanded);
        tableCard.classList.remove('opening','closing');

        if(expanded){
          tableCard.classList.add('opening');
          table.classList.remove('collapsed');
          h1.textContent = i18n[langSel.value].title_full;
          sub.classList.remove('is-hidden');
          btn.textContent = i18n[langSel.value].btn_collapse;
          popupRotateText.textContent = i18n[langSel.value].rotate_expand;
          showPopup(popupRotate);
          hidePopup(popupPortrait);
        } else {
          tableCard.classList.add('closing');
          table.classList.add('collapsed');
          h1.textContent = i18n[langSel.value].title_short;
          sub.classList.add('is-hidden');
          btn.textContent = i18n[langSel.value].btn_expand;
          popupPortraitText.textContent = i18n[langSel.value].rotate_collapse;
          showPopup(popupPortrait);
          hidePopup(popupRotate);
        }
        setTimeout(()=>tableCard.classList.remove('opening','closing'), 820);
      }

      tagColumns();
      setColumnsVisibility(false);           // start collapsed
      applyLanguage(langSel.value);
      initialMotion();

      /* Events */
      btn.addEventListener('click', ()=>{
        const expanded = !table.classList.contains('collapsed');
        setColumnsVisibility(!expanded);
      });
      langSel.addEventListener('change', ()=> applyLanguage(langSel.value));
    })();
  </script>
</body>
</html>
